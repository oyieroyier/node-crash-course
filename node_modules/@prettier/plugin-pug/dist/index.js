"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.logger = exports.createLogger = exports.Logger = exports.LogLevel = exports.defaultOptions = exports.options = exports.printers = exports.parsers = exports.languages = exports.plugin = void 0;
const pug_lexer_1 = __importDefault(require("pug-lexer"));
const logger_1 = require("./logger");
const options_1 = require("./options");
const converge_1 = require("./options/converge");
const printer_1 = require("./printer");
exports.plugin = {
    languages: [
        {
            name: 'Pug',
            parsers: ['pug'],
            tmScope: 'text.jade',
            aceMode: 'jade',
            codemirrorMode: 'pug',
            codemirrorMimeType: 'text/x-pug',
            extensions: ['.jade', '.pug'],
            linguistLanguageId: 179,
            vscodeLanguageIds: ['jade', 'pug'],
        },
    ],
    parsers: {
        pug: {
            parse(text, parsers, options) {
                logger_1.logger.debug('[parsers:pug:parse]:', { text });
                let trimmedAndAlignedContent = text.replace(/^\s*\n/, '');
                const contentIndentation = /^\s*/.exec(trimmedAndAlignedContent);
                if (contentIndentation?.[0]) {
                    const contentIndentationRegex = new RegExp(`(^|\\n)${contentIndentation[0]}`, 'g');
                    trimmedAndAlignedContent = trimmedAndAlignedContent.replace(contentIndentationRegex, '$1');
                }
                const content = trimmedAndAlignedContent;
                const tokens = (0, pug_lexer_1.default)(content);
                return { content, tokens };
            },
            astFormat: 'pug-ast',
            hasPragma(text) {
                return (text.startsWith('//- @prettier\n') || text.startsWith('//- @format\n'));
            },
            locStart(node) {
                logger_1.logger.debug('[parsers:pug:locStart]:', { node });
                return 0;
            },
            locEnd(node) {
                logger_1.logger.debug('[parsers:pug:locEnd]:', { node });
                return 0;
            },
            preprocess(text, options) {
                logger_1.logger.debug('[parsers:pug:preprocess]:', { text });
                return text;
            },
        },
    },
    printers: {
        'pug-ast': {
            print(path, options, print) {
                const entry = path.stack[0];
                const { content, tokens } = entry;
                const pugOptions = (0, converge_1.convergeOptions)(options);
                const printer = new printer_1.PugPrinter(content, tokens, pugOptions);
                const result = printer.build();
                logger_1.logger.debug('[printers:pug-ast:print]:', result);
                return result;
            },
            embed(path, print, textToDoc, options) {
                return null;
            },
            insertPragma(text) {
                return `//- @prettier\n${text}`;
            },
        },
    },
    options: options_1.options,
    defaultOptions: {},
};
exports.languages = exports.plugin.languages;
exports.parsers = exports.plugin.parsers;
exports.printers = exports.plugin.printers;
exports.options = exports.plugin.options;
exports.defaultOptions = exports.plugin.defaultOptions;
var logger_2 = require("./logger");
Object.defineProperty(exports, "LogLevel", { enumerable: true, get: function () { return logger_2.LogLevel; } });
Object.defineProperty(exports, "Logger", { enumerable: true, get: function () { return logger_2.Logger; } });
Object.defineProperty(exports, "createLogger", { enumerable: true, get: function () { return logger_2.createLogger; } });
Object.defineProperty(exports, "logger", { enumerable: true, get: function () { return logger_2.logger; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBYUEsMERBQTRCO0FBQzVCLHFDQUFrQztBQUVsQyx1Q0FBa0Q7QUFDbEQsaURBQXFEO0FBRXJELHVDQUF1QztBQVMxQixRQUFBLE1BQU0sR0FBVztJQUM1QixTQUFTLEVBQUU7UUFDVDtZQUNFLElBQUksRUFBRSxLQUFLO1lBQ1gsT0FBTyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ2hCLE9BQU8sRUFBRSxXQUFXO1lBQ3BCLE9BQU8sRUFBRSxNQUFNO1lBQ2YsY0FBYyxFQUFFLEtBQUs7WUFDckIsa0JBQWtCLEVBQUUsWUFBWTtZQUNoQyxVQUFVLEVBQUUsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDO1lBQzdCLGtCQUFrQixFQUFFLEdBQUc7WUFDdkIsaUJBQWlCLEVBQUUsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDO1NBQ25DO0tBQ0Y7SUFFRCxPQUFPLEVBQUU7UUFDUCxHQUFHLEVBQUU7WUFDSCxLQUFLLENBQ0gsSUFBWSxFQUNaLE9BQXlDLEVBQ3pDLE9BQXNCO2dCQUV0QixlQUFNLENBQUMsS0FBSyxDQUFDLHNCQUFzQixFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztnQkFFL0MsSUFBSSx3QkFBd0IsR0FBVyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDbEUsTUFBTSxrQkFBa0IsR0FBMkIsTUFBTSxDQUFDLElBQUksQ0FDNUQsd0JBQXdCLENBQ3pCLENBQUM7Z0JBQ0YsSUFBSSxrQkFBa0IsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFO29CQUMzQixNQUFNLHVCQUF1QixHQUFXLElBQUksTUFBTSxDQUNoRCxVQUFVLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQ2pDLEdBQUcsQ0FDSixDQUFDO29CQUNGLHdCQUF3QixHQUFHLHdCQUF3QixDQUFD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